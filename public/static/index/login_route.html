{extend name="index/base" /}
{block name="content"}		
<!-- start: Content -->
<div id="content" class="span10">


	<ul class="breadcrumb">
		<li>
			<i class="icon-home"></i>
			<a href="{:url('index/system/config')}">首页</a> 
			<i class="icon-angle-right"></i>
		</li>
		<li>
			<a href="{:url('index/outside/index')}">公司列表</a> 
			<i class="icon-angle-right"></i>
		</li>
		<li><a href="javascript:void(0);">{:$title}</a></li>
	</ul>

	<div class="row-fluid sortable">		
		<div class="box span12">
			<div class="box-header" data-original-title>
				<h2><i class="halflings-icon white th-list"></i><span class="break"></span>{:$title}</h2>
				<div class="box-icon">
					<a href="javascript:void(0);"><i class="halflings-icon white plus"></i></a>							
				</div>						
			</div>
			<div class="box-content">
				<div class="alert alert-success" style="display: none;">
					<button type="button" class="close" data-dismiss="alert">×</button>
					<strong></strong>
				</div>
				<div class="alert alert-error" style="display: none;">
					<button type="button" class="close" data-dismiss="alert">×</button>
					<strong></strong>
				</div>
				<table class="table table-striped">
					<thead>
						<tr>
							<th style="text-align: center;">ID</th>
							<th style="text-align: center;">公司名称</th>
							<th style="text-align: center;">登录账户</th>
							<th style="text-align: center;">密码</th>
							<th style="text-align: center;">登录链接</th>
							<th style="text-align: center;">发布链接</th>
							<th style="text-align: center;">所属平台</th>
							<th style="text-align: center;">状态</th>
							<th style="text-align: center;">录入时间</th>
							<th style="text-align: center;">操作</th>   									  
						</tr>
					</thead>   
					<tbody>
						{foreach name="data" item="vo"}
						<tr>
							<td style="text-align: center;">{$vo.id}</td>
							<td style="text-align: center;">{$company.company}</td>
							<td style="text-align: center;">{$vo.username}</td>
							<td style="text-align: center;">{$vo.password}</td>
							<td style="text-align: center;">{$vo.login_url}</td>
							<td style="text-align: center;">{$vo.outside_url}</td>
							<td style="text-align: center;">{$vo.platform}</td>
							<td style="text-align: center;">
								{if condition="$vo.status == 1"} 
								<span style="cursor:pointer;" class="label label-success" alt="{:$vo.id}">启用</span>
								{else /}
								<span style="cursor:pointer;" class="label label-important" alt="{:$vo.id}">禁用</span>
							{/if}</td>
							<td style="text-align: center;">{$vo.addtime}</td>
							<td style="text-align: center;">
								<a class="btn btn-info" alt="{$vo.id}" href="JavaScript:void(0);">
									<i class="halflings-icon white edit"></i>  
								</a>
							</td>   									  
						</tr>
						{/foreach}
					</tbody>
				</table>  
				<div class="pagination pagination-centered" style="float:right">
					{:$page}
				</div>        
			</div>
		</div><!--/span-->

	</div><!--/row-->

</div><!--/.fluid-container-->

<!-- end: Content -->
</div><!--/#content.span10-->
</div><!--/fluid-row-->
<div class="modal hide fade" id="myModal" style="left: 35%;width: 60%">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal">×</button>
		<h3>添加公司</h3>
	</div>
	<div class="modal-body">
		<form class="form-horizontal" method="POST" action="{:url('index/outside/addLogin')}">
			<input type="hidden" name="id" value="">
			<input type="hidden" name="company_id" value="{:$company.id}">
			<fieldset>				
				<div class="control-group error">
					<label class="control-label"><font color="red">* </font>登录账户</label>
					<div class="controls">
						<input type="text" class="input-xlarge" name="username"  value="">
						<span class="help-inline">请输入登录账户</span>
					</div>
				</div>
				<div class="control-group error">
					<label class="control-label"><font color="red">* </font>登录账户CSS选择器</label>
					<div class="controls">
						<input type="text" class="input-xlarge" name="input_user"  value="">
						<span class="help-inline">请输入登录账户CSS选择器</span><br/>
						<font color="red">
							例：id="username"->#username 如果有多个ID一样的则写它父级，父级为class="login",则写.login>#username<br/>
							class="username"->.username 如果有多个class一样的则写它父级，父级为class="login",则写.login>.username<br/>
							name="username"->input[name='username'] 如果有多个name="username"一样的则写它父级，父级为class="login",则写.login>input[name='username']<br/>
							三选一
						</font>
					</div>
				</div>
				<div class="control-group error">
					<label class="control-label"><font color="red">* </font>密码</label>
					<div class="controls">
						<input type="text" class="input-xlarge" name="password"  value="">
						<span class="help-inline">请输入密码</span>
					</div>
				</div>	
				<div class="control-group error">
					<label class="control-label"><font color="red">* </font>密码CSS选择器</label>
					<div class="controls">
						<input type="text" class="input-xlarge" name="input_pass"  value="">
						<span class="help-inline">请输入密码CSS选择器</span>
					</div>
				</div>	
				<div class="control-group error">
					<label class="control-label"><font color="red">* </font>登录按钮CSS选择器</label>
					<div class="controls">
						<input type="text" class="input-xlarge" name="input_submit"  value="">
						<span class="help-inline">请输入登录按钮CSS选择器</span>
					</div>
				</div>
				<div class="control-group error">
					<label class="control-label"><font color="red">* </font>登录链接</label>
					<div class="controls">
						<input type="text" class="input-xlarge" name="login_url"  value="">
						<span class="help-inline">请输入登录链接</span>
					</div>
				</div>	
				<div class="control-group error">
					<label class="control-label"><font color="red">* </font>发布文章链接</label>
					<div class="controls">
						<input type="text" class="input-xlarge" name="outside_url"  value="">
						<span class="help-inline">请输入登录链接</span>
					</div>
				</div>
				<div class="control-group error">
					<label class="control-label"><font color="red">* </font>所属平台</label>
					<div class="controls">
						<input type="text" class="input-xlarge" name="platform"  value="">
						<span class="help-inline">请输入所属平台</span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">验证码图片CSS选择器</label>
					<div class="controls">
						<input type="text" class="input-xlarge" name="input_code"  value="">
						<span class="help-inline">是否有验证码，有则填写</span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">验证码CSS选择器</label>
					<div class="controls">
						<input type="text" class="input-xlarge" name="input_code_enter"  value="">
						<span class="help-inline">是否有验证码，有则填写</span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">Iframe CSS选择器</label>
					<div class="controls">
						<input type="text" class="input-xlarge" name="input_iframe"  value="">
						<span class="help-inline">是否镶嵌Iframe，有则填写</span>
					</div>
				</div>					
			</fieldset>
		</form>
	</div>
	<div class="modal-footer">
		<a href="JavaScript:void(0);" class="btn" data-dismiss="modal">Close</a>
		<a href="JavaScript:void(0);" class="btn btn-primary">Save</a>
	</div>
</div>
<div class="clearfix"></div>

<!-- start: JavaScript-->
<script src="__INDEX__js/jquery-1.9.1.min.js"></script>
<script src="__INDEX__js/jquery-migrate-1.0.0.min.js"></script>

<script src="__INDEX__js/jquery-ui-1.10.0.custom.min.js"></script>

<script src="__INDEX__js/jquery.ui.touch-punch.js"></script>

<script src="__INDEX__js/modernizr.js"></script>

<script src="__INDEX__js/bootstrap.min.js"></script>

<script src="__INDEX__js/jquery.cookie.js"></script>

<script src='__INDEX__js/fullcalendar.min.js'></script>

<script src='__INDEX__js/jquery.dataTables.min.js'></script>

<script src="__INDEX__js/excanvas.js"></script>
<script src="__INDEX__js/jquery.flot.js"></script>
<script src="__INDEX__js/jquery.flot.pie.js"></script>
<script src="__INDEX__js/jquery.flot.stack.js"></script>
<script src="__INDEX__js/jquery.flot.resize.min.js"></script>

<script src="__INDEX__js/jquery.chosen.min.js"></script>

<script src="__INDEX__js/jquery.uniform.min.js"></script>

<script src="__INDEX__js/jquery.cleditor.min.js"></script>

<script src="__INDEX__js/jquery.noty.js"></script>

<script src="__INDEX__js/jquery.elfinder.min.js"></script>

<script src="__INDEX__js/jquery.raty.min.js"></script>

<script src="__INDEX__js/jquery.iphone.toggle.js"></script>

<script src="__INDEX__js/jquery.uploadify-3.1.min.js"></script>

<script src="__INDEX__js/jquery.gritter.min.js"></script>

<script src="__INDEX__js/jquery.imagesloaded.js"></script>

<script src="__INDEX__js/jquery.masonry.min.js"></script>

<script src="__INDEX__js/jquery.knob.modified.js"></script>

<script src="__INDEX__js/jquery.sparkline.min.js"></script>

<script src="__INDEX__js/counter.js"></script>

<script src="__INDEX__js/retina.js"></script>

<script src="__INDEX__js/custom.js"></script>
<script src="__INDEX__js/jquery.form.js"></script>
<script>
	$(function(){
		//添加登录规则
		$('.box-icon').click(function(){
			$('input[name="id"]').val('');
			$('#myModal .modal-header h3').html('添加登录规则');
			$('.input-xlarge').each(function(index,evlenmt){
				if($(this).parents('.control-group').find('.control-label font').html()!=undefined)
				{
					$(this).parents('.control-group').addClass('error');
					$(this).next('.help-inline').show();
				}
			})
			$('#myModal').modal({backdrop: 'static', keyboard: false});
		})
		$('.input-xlarge').blur(function(){
			if($(this).parents('.control-group').find('.control-label font').html()!=undefined&&$(this).val()=='')
			{
				$(this).parents('.control-group').addClass('error');
				$(this).next('.help-inline').show();
			}else if ($(this).parents('.control-group').find('.control-label font').html()!=undefined&&$(this).val()!='')
			{
				$(this).parents('.control-group').removeClass('error');
				$(this).next('.help-inline').hide();
			}
		})
		//修改登录规则
		$('.btn-info').click(function(){
			$('#myModal .modal-header h3').html('修改登录规则');
			var routeId = $(this).attr('alt');
			$('input[name="id"]').val(routeId);
			$('#myModal').modal({backdrop: 'static', keyboard: false});			
			$.ajax({    
				type: 'POST',    
				url: "{:url('index/outside/loginDetails')}",
				dataType:"json",    
				data:{
					"id":routeId
				},
				success:function(data)
				{
					if (data.status!=200)
					{
						$('.alert-error').find('strong').html(data.message);
						$('.alert-error').css('display','block')
						$('.alert-error').fadeOut(3000)
						return false;
					}else
					{
						var route = data.data;
						var value = '';
						$('.input-xlarge').each(function(index,evlenmt){
							switch(index)
							{
								case 0:
								value = route.username;
								break;
								case 1:
								value = route.input_user;
								break;
								case 2:
								value = route.password;
								break;
								case 3:
								value = route.input_pass;
								break;
								case 4:
								value = route.input_submit;
								break;
								case 5:
								value = route.login_url;
								break;
								case 6:
								value = route.outside_url;
								break;
								case 7:
								value = route.platform;
								break;
								case 8:
								value = route.input_code;
								break;
								case 9:
								value = route.input_code_enter;
								break;
								case 10:
								value = route.input_iframe;
								break;

							}
							$(this).val(value);
							if ($(this).parents('.control-group').hasClass('error'))
							{
								$(this).parents('.control-group').removeClass('error');
								$(this).next('.help-inline').hide();
							}						
						})
					}       
				},
				error:function(xhr){ 
					$('.alert-error').find('strong').html('请求数据失败，请联系技术人员');
					$('.alert-error').css('display','block')
					$('.alert-error').fadeOut(3000)
				} 	

			});
		})
		//删除
		$('.label').click(function(){
			var _this = $(this);
			var routeId = $(this).attr('alt');
			if (routeId=='')
			{
				alert('参数错误，刷新当前页面！');
				window.location.reload();
				return false;
			}			
			$.ajax({    
				type: 'POST',    
				url: "{:url('index/outside/loginStatus')}",
				dataType:"json",    
				data:{
					"id":routeId
				},
				success:function(data)
				{
					if (data.status==404)
					{
						$('.alert-error').find('strong').html(data.message);
						$('.alert-error').css('display','block')
						$('.alert-error').fadeOut(3000)
						return false;
					}else if(data.status==0)
					{
						_this.parent('td').html('<span style="cursor:pointer;" class="label label-success" alt="'+routeId+'">启用</span>');
					}else if(data.status==200)
					{
						_this.parent('td').html('<span style="cursor:pointer;" class="label label-important" alt="'+routeId+'">禁用</span>');	
					}else
					{
						$('.alert-error').find('strong').html(data.message);
						$('.alert-error').css('display','block')
						$('.alert-error').fadeOut(3000)
						return false;
					}       
				},
				error:function(xhr){ 
					$('.alert-error').find('strong').html('请求数据失败，请联系技术人员');
					$('.alert-error').css('display','block')
					$('.alert-error').fadeOut(3000)
				} 	

			});

		})
		$(document).on('click','.btn-primary',function(){
			var _this = $(this);   
		//添加或者修改权限		
		$(".form-horizontal").ajaxSubmit({  		
			dataType:"json",    
			beforeSend: function() { 
				_this.removeClass('btn-primary');
			},    	
			success:function(data)
			{
				_this.addClass('btn-primary');
				if (data.status==404)
				{
					$('#myModal').modal('hide')
					$('.alert-error').find('strong').html(data.message);
					$('.alert-error').css('display','block')
					$('.alert-error').fadeOut(3000)
					return false;
				}else if (data.status!=200)
				{
					$("input[name='"+data.name+"']").next().show();	
					$("input[name='"+data.name+"']").parents('.control-group').addClass('error')		  				
					return false;
				}else
				{
					$('#myModal').modal('hide')
					$('.alert-success').find('strong').html(data.message);
					$('.alert-success').css('display','block')
					$('.alert-success').fadeOut(3000);
	        	 	//sleep(3000);
	        	 	setTimeout(function(){  //使用  setTimeout（）方法设定定时2000毫秒
					window.location.reload();//页面刷新
				},3000); 
	        	 }

	        	},
	        error:function(xhr){ //上传失败 
	        	$('.alert-error').find('strong').html('操作失败');
	        	$('.alert-error').css('display','block')
	        	$('.alert-error').fadeOut(3000)
	        } 	

	    });

	})
	})	
</script>
<!-- end: JavaScript-->
{/block}
