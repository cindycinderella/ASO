{extend name="index/base" /}
{block name="content"}		
<style type="text/css">
	.table th, .table td {
		vertical-align: middle;
	}
</style>
<!-- start: Content -->
<div id="content" class="span10">


	<ul class="breadcrumb">
		<li>
			<i class="icon-home"></i>
			<a href="{:url('index/index/home')}">首页</a> 
			<i class="icon-angle-right"></i>
		</li>
		<li><a href="javascript:void(0);">{:$title}</a></li>
	</ul>

	<div class="row-fluid sortable">		
		<div class="box span12">
			<div class="box-header" data-original-title>
				<h2><i class="halflings-icon white th-list"></i><span class="break"></span>{:$title}</h2>
				<div class="box-icon">
					<a href="{:url('index/material/add',['title_id'=>$title_id])}"><i class="halflings-icon white plus"></i></a>							
				</div>						
			</div>
			<div class="box-content alerts">
				<div class="alert alert-success" style="display: none;">
					<button type="button" class="close" data-dismiss="alert">×</button>
					<strong></strong>
				</div>
				<div class="alert alert-error" style="display: none;">
					<button type="button" class="close" data-dismiss="alert">×</button>
					<strong></strong>
				</div>
				<table class="table table-striped">
					<thead>
						<tr>
							<th style="text-align: center;width:70%;"><font><font>内容</font></font></th>
							<th style="text-align: center;"><font><font>标签</font></font></th>
							<th style="text-align: center;"><font><font>录入时间</font></font></th>
							<th style="text-align: center;"><font><font>状态</font></font></th>
							<th style="text-align: center;"><font><font>操作</font></font></th>   									  
						</tr>
					</thead>   
					<tbody>
						{foreach name="title_list" item="vo"}
						<tr>
							<td style="text-align: center;overflow: hidden;width: 100%;height: 30px;display: inline-block;"><font><font>{:html_entity_decode($vo.content)}</font></font></td>
							<td style="text-align: center;"><font><font>{:$vo.tag}</font></font></td>
							<td style="text-align: center;"><font><font>{:date("Y-m-d H:i:s",$vo.addtime)}</font></font></td>
							<td style="text-align: center;">
								{if condition="$vo.status == 1"} 
								<span style="cursor:pointer;" class="label label-success" alt="{:$vo.id}"><font><font>启用</font></font></span>
								{else /}
								<span style="cursor:pointer;" class="label label-important" alt="{:$vo.id}"><font><font>禁用</font></font></span>
								{/if}
							</td>
							<td style="text-align: center;">											
								<a class="btn btn-info" href="{:url('index/material/add',['title_id'=>$title_id,'material_id'=>$vo['id']])}">
									<i class="halflings-icon white edit"></i>  
								</a>
								<a class="btn btn-danger" alt="{:$vo.id}" href="JavaScript:void(0);">
									<i class="halflings-icon white trash"></i> 
								</a>								
							</td>	
						</tr>		
						{/foreach}


					</tbody>
				</table>  
				<div class="pagination pagination-centered" style="float:right">
					<div style="float: right; margin-left: 20px;margin-top: 20px;">
						到第
						<input type="text" style="width: 27px;text-align: center;" name="jump_page">
						页
						<a href="JavaScript:void(0);" class="jump_page" style="background-color: #f7f7f7;
						background-repeat: repeat-x;
						border: 1px solid #ddd;
						color: #666;
						padding: 4px 13px 3px;border-radius: 2px;
						cursor: pointer;
						display: inline-block;
						text-align: center;
						text-decoration: none;
						margin-left: 10px;">确定</a>
					</div>
					{:$page}
				</div>        
			</div>
		</div><!--/span-->

	</div><!--/row-->

</div><!--/.fluid-container-->

<!-- end: Content -->
</div><!--/#content.span10-->
</div><!--/fluid-row-->



<div class="clearfix"></div>

<!-- start: JavaScript-->
<script src="__INDEX__js/jquery-1.9.1.min.js"></script>
<script src="__INDEX__js/jquery-migrate-1.0.0.min.js"></script>

<script src="__INDEX__js/jquery-ui-1.10.0.custom.min.js"></script>

<script src="__INDEX__js/jquery.ui.touch-punch.js"></script>

<script src="__INDEX__js/modernizr.js"></script>

<script src="__INDEX__js/bootstrap.min.js"></script>

<script src="__INDEX__js/jquery.cookie.js"></script>

<script src='__INDEX__js/fullcalendar.min.js'></script>

<script src='__INDEX__js/jquery.dataTables.min.js'></script>

<script src="__INDEX__js/excanvas.js"></script>
<script src="__INDEX__js/jquery.flot.js"></script>
<script src="__INDEX__js/jquery.flot.pie.js"></script>
<script src="__INDEX__js/jquery.flot.stack.js"></script>
<script src="__INDEX__js/jquery.flot.resize.min.js"></script>

<script src="__INDEX__js/jquery.chosen.min.js"></script>

<script src="__INDEX__js/jquery.uniform.min.js"></script>

<script src="__INDEX__js/jquery.cleditor.min.js"></script>

<script src="__INDEX__js/jquery.noty.js"></script>

<script src="__INDEX__js/jquery.elfinder.min.js"></script>

<script src="__INDEX__js/jquery.raty.min.js"></script>

<script src="__INDEX__js/jquery.iphone.toggle.js"></script>

<script src="__INDEX__js/jquery.uploadify-3.1.min.js"></script>

<script src="__INDEX__js/jquery.gritter.min.js"></script>

<script src="__INDEX__js/jquery.imagesloaded.js"></script>

<script src="__INDEX__js/jquery.masonry.min.js"></script>

<script src="__INDEX__js/jquery.knob.modified.js"></script>

<script src="__INDEX__js/jquery.sparkline.min.js"></script>

<script src="__INDEX__js/counter.js"></script>

<script src="__INDEX__js/retina.js"></script>

<script src="__INDEX__js/custom.js"></script>
<script>
	$(document).on('click','.label',function(){
		var title_id = $(this).attr('alt');
		var _this = $(this);
		$.ajax({    
			type: 'POST',    
			url: "{:url('index/material/status')}",
			dataType:"json",    
			data:{
				"title_id":title_id
			},
			success:function(data)
			{
				if (data.status==404)
				{
					$('.alert-error').find('strong').html(data.message);
					$('.alert-error').css('display','block')
					$('.alert-error').fadeOut(3000)
					return false;
				}else if(data.status==0)
				{
					_this.parent('td').html('<span style="cursor:pointer;" class="label label-success" alt="'+title_id+'"><font><font>启用</font></font></span>');
				}else if(data.status==200)
				{
					_this.parent('td').html('<span style="cursor:pointer;" class="label label-important" alt="'+title_id+'"><font><font>禁用</font></font></span>');	
				}else
				{
					$('.alert-error').find('strong').html(data.message);
					$('.alert-error').css('display','block')
					$('.alert-error').fadeOut(3000)
					return false;
				}    
			}	

		});

	})
	$(function(){
		//跳页
		$('.jump_page').click(function(){
			var page = $("input[name='jump_page']").val();
			if (page=='')
			{
				alert('请输入跳转页！');
				return false;
			}
			window.location.href="{:url('index/material/title',array('id'=>$title_id))}"+'?page='+page;			
		})
		//删除
		$('.btn-danger').click(function(){
			var _this = $(this);
			var material_id = $(this).attr('alt');
			if (material_id=='')
			{
				alert('参数错误，刷新当前页面！');
				window.location.reload();
				return false;
			}			
			$.ajax({    
				type: 'POST',    
				url: "{:url('index/material/delete')}",
				dataType:"json",    
				data:{
					"material_id":material_id
				},
				success:function(data)
				{
					if(data.status==200)
					{
						_this.parents('tr').remove();
						return false;
					}else
					{
						$('.alert-error').find('strong').html(data.msg);
						$('.alert-error').css('display','block')
						$('.alert-error').fadeOut(3000)
					}    
				},
				error:function(xhr){ 
					$('.alert-error').find('strong').html('请求数据失败，请联系技术人员');
					$('.alert-error').css('display','block')
					$('.alert-error').fadeOut(3000)
				} 	

			});

		})
	})
</script>
<!-- end: JavaScript-->
{/block}
