{extend name="index/base" /}
{block name="content"}		
<!-- start: Content -->
<div id="content" class="span10">


	<ul class="breadcrumb">
		<li>
			<i class="icon-home"></i>
			<a href="{:url('index/system/config')}">首页</a> 
			<i class="icon-angle-right"></i>
		</li>
		<li><a href="javascript:void(0);">{:$title}</a></li>
	</ul>

	<div class="row-fluid sortable">		
		<div class="box span12">
			<div class="box-header" data-original-title>
				<h2><i class="halflings-icon white th-list"></i><span class="break"></span>{:$title}</h2>
				<div class="box-icon">
					<a href="javascript:void(0);"><i class="halflings-icon white plus"></i></a>							
				</div>						
			</div>
			<div class="box-content">
				<div class="alert alert-success" style="display: none;">
					<button type="button" class="close" data-dismiss="alert">×</button>
					<strong></strong>
				</div>
				<div class="alert alert-error" style="display: none;">
					<button type="button" class="close" data-dismiss="alert">×</button>
					<strong></strong>
				</div>
				<table class="table table-striped">
					<thead>
						<tr>
							<th style="text-align: center;">id</th>
							<th style="text-align: center;">父权限</th>
							<th style="text-align: center;">权限名</th>
							<th style="text-align: center;">描述</th>
							<th style="text-align: center;">排序</th>
							<th style="text-align: center;">图标</th>
							<th style="text-align: center;">是否显示</th>
							<th style="text-align: center;">操作</th>   									  
						</tr>
					</thead>   
					<tbody>
						{foreach name="nav_list" item="vo"}
						<tr>
							<td style="text-align: center;">{:$vo.id}</td>
							<td style="text-align: center;" alt="{:$vo.pid}">{:$vo.pid_name}</td>
							<td style="text-align: center;">{:$vo.url}</td>
							<td style="text-align: center;">{:$vo.name}</td>
							<td style="text-align: center;">{:$vo.asc}</td>
							<td style="text-align: center;" alt="{:$vo.css_img}">{if condition="$vo.css_img != ''"}<i class="{:$vo.css_img}"></i>{/if}</td>
							<td style="text-align: center;">{if condition="$vo.status == 1"} 
								<span style="cursor:pointer;" class="label label-success status" alt="{:$vo.id}">是</span>
								{else /}
								<span style="cursor:pointer;" class="label label-important status" alt="{:$vo.id}">否</span>
								{/if}
							</td>
							<td style="text-align: center;">
								<a class="btn btn-info" href="JavaScript:void(0);">
									<i class="halflings-icon white edit"></i>  
								</a>
							</td> 
						</tr>
						{/foreach}
					</tbody>
				</table>  
				<div class="pagination pagination-centered" style="float:right">
					{:$page}
				</div>        
			</div>
		</div><!--/span-->

	</div><!--/row-->

</div><!--/.fluid-container-->

<!-- end: Content -->
</div><!--/#content.span10-->
</div><!--/fluid-row-->

<div class="modal hide fade" id="myModal" style="left: 39%;width: 50%">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal">×</button>
		<h3>修改权限</h3>
	</div>
	<div class="modal-body" style="max-height: 530px;">
		<form class="form-horizontal" method="POST" action="{:url('index/System/add')}">
			<input type="hidden" name="id" value="">
			<fieldset>
				<div class="control-group">
					<label class="control-label" for="selectError3">父级权限</label>
					<div class="controls">
						<select id="selectError3" name="pid">
							<option value="0">选择父级权限</option>
							{foreach name="parents" item="navInfo"}
							<option value="{:$navInfo.id}">{:$navInfo.name}</option>
							{/foreach}
						</select>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label"><font color="red">* </font>权限名称</label>
					<div class="controls">
						<input type="text" class="input-xlarge" name="url"  value="">
						<span class="help-inline" style="display: none;">请输入权限名称</span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label"><font color="red">* </font>描述</label>
					<div class="controls">
						<input type="text" class="input-xlarge"  name="name" value="">
						<span class="help-inline" style="display: none;">请输入描述</span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">图标</label>
					<div class="controls">
						<input type="text" class="input-xlarge" name="css_img"  value="">
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">是否显示菜单栏</label>
					<div class="controls">
						<select id="selectError" name="status" style="width: 100px;">
							<option value="1">显示</option>
							<option value="-1">隐藏</option>
						</select>
					</div>
				</div>	
				<div class="control-group">
					<label class="control-label">排序</label>
					<div class="controls">
						<input type="text" onkeyup="value=value.replace(/[^\d]/g,'')" class="input-xlarge"  name="asc" style="width: 50px;"  value="0">
						<font color="red">由大到小排序</font>
					</div>
				</div>
			</fieldset>
		</form>
	</div>
	<div class="modal-footer">
		<a href="JavaScript:void(0);" class="btn" data-dismiss="modal">Close</a>
		<a href="JavaScript:void(0);" class="btn btn-primary">Save</a>
	</div>
</div>

<div class="clearfix"></div>

<!-- start: JavaScript-->
<script src="__INDEX__js/jquery-1.9.1.min.js"></script>
<script src="__INDEX__js/jquery-migrate-1.0.0.min.js"></script>

<script src="__INDEX__js/jquery-ui-1.10.0.custom.min.js"></script>

<script src="__INDEX__js/jquery.ui.touch-punch.js"></script>

<script src="__INDEX__js/modernizr.js"></script>

<script src="__INDEX__js/bootstrap.min.js"></script>

<script src="__INDEX__js/jquery.cookie.js"></script>

<script src='__INDEX__js/fullcalendar.min.js'></script>

<script src='__INDEX__js/jquery.dataTables.min.js'></script>

<script src="__INDEX__js/excanvas.js"></script>
<script src="__INDEX__js/jquery.flot.js"></script>
<script src="__INDEX__js/jquery.flot.pie.js"></script>
<script src="__INDEX__js/jquery.flot.stack.js"></script>
<script src="__INDEX__js/jquery.flot.resize.min.js"></script>

<script src="__INDEX__js/jquery.chosen.min.js"></script>

<script src="__INDEX__js/jquery.uniform.min.js"></script>

<script src="__INDEX__js/jquery.cleditor.min.js"></script>

<script src="__INDEX__js/jquery.noty.js"></script>

<script src="__INDEX__js/jquery.elfinder.min.js"></script>

<script src="__INDEX__js/jquery.raty.min.js"></script>

<script src="__INDEX__js/jquery.iphone.toggle.js"></script>

<script src="__INDEX__js/jquery.uploadify-3.1.min.js"></script>

<script src="__INDEX__js/jquery.gritter.min.js"></script>

<script src="__INDEX__js/jquery.imagesloaded.js"></script>

<script src="__INDEX__js/jquery.masonry.min.js"></script>

<script src="__INDEX__js/jquery.knob.modified.js"></script>

<script src="__INDEX__js/jquery.sparkline.min.js"></script>

<script src="__INDEX__js/counter.js"></script>

<script src="__INDEX__js/retina.js"></script>

<script src="__INDEX__js/custom.js"></script>
<script src="__INDEX__js/jquery.form.js"></script>
<script>	
	$('.btn-info').click(function(){
		$('#myModal .modal-header h3').html('修改权限');
		$(this).parents('tr').find('td').each(function(index,e){
			if (index==0)
			{
				$("input[name='id']").val($(this).html());
			}else if (index==1)
			{
				var pid = $(this).attr('alt');
				if (pid==100000)
				{
					pid =1;
				}
				$("#selectError3").val(pid);
			}else if (index==2)
			{
				$("input[name='url']").val($(this).html());
			}else if (index==3)
			{
				$("input[name='name']").val($(this).html());
			}else if (index==4)
			{
				$("input[name='asc']").val($(this).html());
			}else if (index==5)
			{
				var pid = $(this).attr('alt');
				$("input[name='css_img']").val(pid);
			}else if (index==6)
			{
				var status = $(this).find('span').html();
				$("#selectError option").each(function(index,e){
					$(this).attr("selected",false);					
					if (status=='是')
					{
						if ($(this).html()=='显示')
						{
							$(this).attr("selected",true);
						}
						
					}else
					{
						if ($(this).html()=='隐藏')
						{
							$(this).attr("selected",true);
						}
					}

				})
			}
		})	

		$('#myModal').modal({backdrop: 'static', keyboard: false});
	})
	$('.box-icon').click(function(){
		$("input[name='id']").val('');
		$('#myModal .modal-header h3').html('添加权限');
		$('#myModal').modal({backdrop: 'static', keyboard: false});
	})
	$('input[name="name"]').blur(function(){
		if ($(this).val()!='')
		{
			$("input[name='name").next().hide();	
			$("input[name='name']").parents('.control-group').removeClass('error')
		}
	})
	$('input[name="url"]').blur(function(){
		if ($(this).val()!='')
		{
			$("input[name='url").next().hide();	
			$("input[name='url']").parents('.control-group').removeClass('error')
		}
	})
	$(document).on('click','.btn-primary',function(){
		var _this = $(this);   
		//添加或者修改权限		
		$(".form-horizontal").ajaxSubmit({  		
			dataType:"json",    
			beforeSend: function() { 
				_this.removeClass('btn-primary');
			},    	
			success:function(data)
			{
				_this.addClass('btn-primary');
				if (data.status==404)
				{
					$('#myModal').modal('hide')
					$('.alert-error').find('strong').html(data.message);
					$('.alert-error').css('display','block')
					$('.alert-error').fadeOut(3000)
					return false;
				}else if (data.status!=200)
				{
					$("input[name='"+data.name+"']").next().show();	
					$("input[name='"+data.name+"']").parents('.control-group').addClass('error')		  				
					return false;
				}else
				{
					$('#myModal').modal('hide')
					$('.alert-success').find('strong').html(data.message);
					$('.alert-success').css('display','block')
					$('.alert-success').fadeOut(3000);
	        	 	//sleep(3000);
	        	 	setTimeout(function(){  //使用  setTimeout（）方法设定定时2000毫秒
					window.location.reload();//页面刷新
				},3000); 
	        	 }

	        	},
	        error:function(xhr){ //上传失败 
	        	$('.alert-error').find('strong').html('操作失败');
	        	$('.alert-error').css('display','block')
	        	$('.alert-error').fadeOut(3000)
	        } 	

	    });

	})
	$(document).on('click','.status',function(){
		var title_id = $(this).attr('alt');
		var _this = $(this);
		$.ajax({    
			type: 'POST',    
			url: "{:url('index/System/navStatus')}",
			dataType:"json",    
			data:{
				"title_id":title_id
			},
			success:function(data)
			{
				if(data.status==0)
				{
					$('.alert-success').find('strong').html(data.message);
					$('.alert-success').css('display','block')
					$('.alert-success').fadeOut(3000);
	        	 	setTimeout(function(){  //使用  setTimeout（）方法设定定时2000毫秒
					window.location.reload();//页面刷新
					},2000);
	        	}else
	        	 {
	        	 	$('.alert-error').find('strong').html(data.message);
	        	 	$('.alert-error').css('display','block')
	        	 	$('.alert-error').fadeOut(3000)
	        	 }    
	        	},
	        	error: function() {
	        		$('.alert-error').find('strong').html('请求数据失败，请联系技术人员');
	        		$('.alert-error').css('display','block')
	        		$('.alert-error').fadeOut(3000)
	        	}	

	        });

	})
</script>
<!-- end: JavaScript-->
{/block}
